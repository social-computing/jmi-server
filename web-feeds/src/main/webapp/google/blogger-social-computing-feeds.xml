<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Map your blog!" title_url="http://www.mapyourfeeds.com/" width="300" height="300" 
	  	author="Social Computing" author_email="mapyourfeeds@social-computing.com" author_link="http://www.social-computing.com"
		description="View and navigate your posts thru an interactive map! by Social Computing" 
		screenshot="http://www.mapyourfeeds.com/images/screenshot.png" 
		thumbnail="http://www.mapyourfeeds.com/images/thumbnail.png">
    <Icon>http://www.social-computing.com/favicon.ico</Icon>
	<Require feature="google.blog"/>
    <Require feature="flash" />
  </ModulePrefs>
  <Content type="html" view="home,profile,canvas">
<![CDATA[
<div id='wps-feeds'></div>
<script type="text/javascript" language="javascript"> 
  
  var viewFeeds = new google.Blog(getFeedUrl, window.name); 
  
  function getFeedUrl() {
	  var flashvars = {
		allowDomain: "*",
		wpsserverurl: "http%3A%2F%2Fmap.social-computing.com%2F",
		wpsplanname: "Feeds",
		analysisProfile: "GlobalProfile",
		feed: viewFeeds.getPostsFeedUrl()
	   };

	   var parameters = gadgets.views ? gadgets.views.getParams() : null;
	   if( parameters) {
	    	for (var prop in parameters) {
	    		flashvars[prop] = parameters[prop];
	   		}
	   }
	   var fv='';
	   for (var prop in flashvars) {
	      if (fv) fv=fv+'&'
	      fv=fv + prop + '=' + flashvars[prop];
	   }
	   var params= {
			bgcolor: "fff", allowFullScreen: "true", allowscriptaccess: "always",
	        allowNetworking: "all", quality: "high", menu: "true", 
	        flashvars: fv
	   };
	   gadgets.flash.embedFlash('http://www.mapyourfeeds.com/client/wps-flex-1.0-SNAPSHOT.swf', 'wps-feeds', 10, params);
  }

  function getMap() {
  	 return document.getElementById('wps-feeds').childNodes[0];
  }
    
  function empty() {
 	 alert( "Sorry, map is empty");
  }
  function ready() {
   // do something here
  }
  function status( status) {
   // do something here
  }
  function error( error) {
   	alert( error);
  }
  function Navigate( url) {
 	 window.open( url, "_blank");
  }
  function NewWin( args)
  {
	var parameters = {};
	parameters["entityId"] = args[0];
	parameters["feed"] = args[2];
	getMap().compute( parameters);
  }
  function Discover( args)
  {
	var parameters = {};
	parameters["attributeId"] = args[0];
	parameters["analysisProfile"] = "DiscoveryProfile";
	parameters["feed"] = args[2];
  	getMap().compute( parameters);
  }
</script>
]]>   
</Content>
</Module>