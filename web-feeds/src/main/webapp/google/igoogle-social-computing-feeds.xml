<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Just Map It! Feeds" title_url="http://feeds.just-map-it.com/" width="300" height="300" 
	  	author="Social Computing" author_email="justmapit@social-computing.com" author_link="http://www.social-computing.com"
		description="View and navigate your feeds thru an interactive map! by Social Computing" 
		screenshot="http://feeds.just-map-it.com/images/screenshot.png" 
		thumbnail="http://feeds.just-map-it.com/images/thumbnail.png">
    <Icon>http://www.social-computing.com/favicon.ico</Icon>
    <Require feature="flash" />
    <Require feature="settitle"/>
  </ModulePrefs>
  <UserPref name="feed" display_name="Feed" datatype="string" required="true" default_value="http://www.social-computing.com/feed/"/>
  <Content type="html" view="home,profile,canvas">
<![CDATA[
<div id='wps-feeds'></div>
<script type="text/javascript" language="javascript"> 
 var prefs = new gadgets.Prefs();
 var flashvars = {
	allowDomain: "*",
	wpsserverurl: "http%3A%2F%2Fmap.social-computing.com%2F",
	wpsplanname: "Feeds",
	analysisProfile: "GlobalProfile",
	feed: prefs.getString( "feed")
   };
   var parameters = gadgets.views ? gadgets.views.getParams() : null;
   if( parameters) {
    	for (var prop in parameters) {
    		flashvars[prop] = parameters[prop];
   		}
   }
   var fv='';
   for (var prop in flashvars) {
      if (fv) fv=fv+'&';
      fv=fv + prop + '=' + flashvars[prop];
   }
   var params= {
		bgcolor: "fff", allowFullScreen: "true", allowscriptaccess: "always",
        allowNetworking: "all", quality: "high", menu: "true", 
        flashvars: fv
 	};
  	gadgets.flash.embedFlash('http://feeds.just-map-it.com/client/wps-flex-1.0-SNAPSHOT.swf', 'wps-feeds', 10, params);

  function getMap() {
  	 return document.getElementById('wps-feeds').childNodes[0];
  }
    
  function ready() {
    var map = getMap();
    var titles = map.getArrayProperty( "$FEEDS_TITLES");
	if( map.getProperty( "$analysisProfile") == "GlobalProfile" && titles) {
		gadgets.window.setTitle( 'Just Map It! Feeds - ' + titles.join( ', '));
	}
    else {
 	 widget.setTitle( 'Just Map It! Feeds');
    }
  }
  function status( status) {
   // do something here
  }
  function empty() {
  	 gadgets.window.setTitle( 'Just Map It! Feeds');
 	 alert( "Sorry, the map is empty. Does the feed contains categories?");
  }
  function error( error) {
  	gadgets.window.setTitle( 'Just Map It! Feeds');
   	alert( "Sorry, an error occured. Is this URL correct?");
  }
  function JMIF_Navigate( url) {
 	 window.open( url, "_blank");
  }
  function JMIF_Focus( args)
  {
	var parameters = {};
	parameters["entityId"] = args[0];
	parameters["feed"] = args[2];
	getMap().compute( parameters);
  }
  function JMIF_Center( args)
  {
	var parameters = {};
	parameters["attributeId"] = args[0];
	parameters["analysisProfile"] = "DiscoveryProfile";
	parameters["feed"] = args[2];
  	getMap().compute( parameters);
  }
</script>
]]>   
</Content>
</Module>